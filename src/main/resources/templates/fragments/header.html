<div th:fragment="common-header">
  <header class="header">
    <div class="header-wrapper">
      <div class="header-container">

        <!-- 좌측 영역: 로고 + 음악버튼 -->
        <div class="header-left">
          <h1 class="logo">
            <a th:href="@{/main}">
              <img th:src="@{/images/logo/logo.svg}" alt="로고" class="logo-image">
            </a>
          </h1>

          <button id="bgm-toggle" class="music-button"
                  th:attr="data-icon-on=@{/images/icons/music.svg},
                 data-icon-off=@{/images/icons/mute.svg}">
            <img class="icon" th:src="@{/images/icons/mute.svg}" alt="음악 꺼짐">
          </button>

          <audio id="bgm" loop preload="auto">
            <source th:src="@{/audio/BGM.mp3}" type="audio/mpeg">
          </audio>
        </div>

        <!-- 우측 영역: 로그인/유저 -->
        <div class="header-user">
          <!-- 로그인 O -->
          <div sec:authorize="isAuthenticated()" th:if="${currentUser != null}" class="user-dropdown">
            <div class="user-welcome" onclick="toggleDropdown(event)">
              <span class="welcome-text">안녕하세요</span>
              <span class="user-name" th:text="${#authentication?.principal?.nickname} ?: '사용자'">닉네임</span>
              <span class="welcome-text">님!</span>
              <svg class="dropdown-arrow">
                <path d="M2 4L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              <img class="profile-image"
                   th:src="${#strings.isEmpty(#authentication?.principal?.profileImage)
              ? defaultProfileImage
              : #authentication.principal.profileImage}"
                   alt="프로필 이미지"/>
            </div>
            <div class="dropdown-menu">
              <!-- 프로필 -->
              <a th:href="@{/profile}" class="dropdown-item">
                <img th:src="@{/images/icons/person.svg}" alt="프로필" class="icon profile-icon">
                <span>프로필</span>
              </a>
              <hr class="dropdown-divider">
              <!-- 로그아웃 -->
              <form class="dropdown-logout-form" th:action="@{/logout}" method="post">
                <button type="submit" class="dropdown-item logout-item">
                  <img th:src="@{/images/icons/logout.svg}" alt="로그아웃" class="icon">
                  <span>로그아웃</span>
                </button>
              </form>
            </div>
          </div>

          <!-- 로그인 X -->
          <div sec:authorize="isAnonymous()">
            <a th:href="@{/login}" class="login-button">로그인</a>
          </div>
        </div>

      </div>
    </div>
  </header>
</div>