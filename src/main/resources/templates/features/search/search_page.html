<!-- src/main/resources/templates/features/search/search_page.html -->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>국가유산 검색 | Heritage Hunters</title>

    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/common/css/style.css}" />
    <link rel="stylesheet" th:href="@{/features/search/css/search_page.css}" />
  </head>
  <body>
    <div id="root">
      <!-- 헤더 -->
      <!-- <header th:replace="fragments/header :: header"></header> -->

      <!-- 메인 -->
      <main id="container" class="search">
        <form id="search-form" th:action="@{/search}" method="get" class="search__form">
          <!-- 1. 검색창 -->
          <section class="search-top">
            <label for="keyword" class="search__label">검색어</label>
            <input type="text" id="keyword" name="keyword" placeholder="검색어를 입력해주세요" th:value="${keyword}" class="search__input" />
            <input type="hidden" name="searchTriggered" value="true" />
            <button type="submit" class="search__btn">검색</button>
          </section>

          <!-- 2. 필터 컨트롤 -->
          <div class="search__filter-controls">
            <button type="button" class="search__action-btn search__reset-btn" id="reset-filters">초기화</button>

            <button
              type="button"
              class="search__action-btn search__toggle-btn"
              id="toggle-filters"
              aria-expanded="${results?.empty ?: true}"
              th:text="${results?.empty ?: true} ? '상세검색 닫기' : '상세검색 열기'"
            ></button>
          </div>
          <!-- 3. 다중 체크박스 필터 -->
          <section class="search-mid" id="filter-panel" th:classappend="${results?.empty ?: true} ? ' search-mid--open' : ' search-mid--closed'">
            <div class="search__filters">
              <!-- 지정 종목 -->
              <div class="search__filter search__filter--designation">
                <h3 class="search__filter-title">지정 종목</h3>
                <div class="search__filter-options">
                  <ul class="search__options-list">
                    <li th:each="code : ${designationCodes}">
                      <label class="search__option">
                        <input
                          type="checkbox"
                          name="designation"
                          th:value="${code}"
                          th:checked="${code == '00' or (selectedDesignations != null and selectedDesignations.contains(code))}"
                        />
                        <span th:text="${designationMap.get(code)}">전체</span>
                      </label>
                    </li>
                  </ul>
                </div>
              </div>

              <!-- 지역 -->
              <div class="search__filter search__filter--region">
                <h3 class="search__filter-title">지역</h3>
                <div class="search__filter-options">
                  <ul class="search__options-list">
                    <li th:each="code : ${regionCodes}">
                      <label class="search__option">
                        <input
                          type="checkbox"
                          name="region"
                          th:value="${code}"
                          th:checked="${code == '00' or (selectedRegions != null and selectedRegions.contains(code))}"
                        />
                        <span th:text="${regionMap.get(code)}">전체</span>
                      </label>
                    </li>
                  </ul>
                </div>
              </div>

              <!-- 시대 -->
              <div class="search__filter search__filter--era">
                <h3 class="search__filter-title">시대</h3>
                <div class="search__filter-options">
                  <ul class="search__options-list">
                    <!-- eraOptions 는 List<EraCategory> -->
                    <li th:each="era : ${eraOptions}">
                      <label class="search__option">
                        <input
                          type="checkbox"
                          name="era"
                          th:value="${era.displayName}"
                          th:checked="${(selectedEras == null or #lists.isEmpty(selectedEras)) ? era.displayName == '전체' : selectedEras.contains(era)}"
                        />
                        <span th:text="${era.displayName}">전체</span>
                      </label>
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="search__actions">
              <button type="submit" form="search-form" class="search__btn">검색</button>
            </div>
          </section>
        </form>

        <!-- 3. 검색 결과 그리드 & 페이지네이션 -->
        <section class="search-bottom">
          <div class="search__results">
            <div class="search__grid">
              <a th:href="@{/heritage/{id}(id=${item.id})}" class="search__card-link" th:each="item : ${results}">
                <article class="search__card">
                  <img th:src="${item.thumbnailUrl}" alt="유물 대표 이미지" class="search__card-image" loading="lazy" />
                  <p class="search__card-designation" th:text="${item.designation}">유산 분류</p>
                  <h4 class="search__card-title" th:text="${item.name}">유산 이름</h4>
                  <p class="search__card-hanja" th:text="${item.nameHanja}">유산 한자 이름</p>
                </article>
              </a>
            </div>
          </div>

          <!-- pagination 폼 추가 -->
          <form id="pagination-form" th:action="@{/search}" method="get">
            <!-- 현재 필터/키워드 값을 모두 hidden 으로 보관 -->
            <input type="hidden" name="keyword" th:value="${keyword}" />
            <input type="hidden" name="designation" th:each="d : ${selectedDesignations}" th:value="${d}" />
            <input type="hidden" name="region" th:each="r : ${selectedRegions}" th:value="${r}" />
            <input type="hidden" name="era" th:each="e : ${selectedEras}" th:value="${e}" />

            <nav class="search__pagination" th:if="${results != null and !results.empty}">
              <ul class="search__pagination-list">
                <!-- 첫 페이지로 -->
                <li>
                  <button type="submit" name="page" th:value="1" class="search__pagination-link">&lt;&lt;</button>
                </li>

                <!-- 이전 페이지 그룹으로 -->
                <li th:if="${hasPrev}">
                  <button type="submit" name="page" th:value="${currentPage - 1}" class="search__pagination-link">&lt;</button>
                </li>

                <!-- 개별 페이지 번호 -->
                <li th:each="num : ${pageNumbers}">
                  <button
                    type="submit"
                    name="page"
                    th:value="${num}"
                    th:classappend="${num == currentPage} 
                          ? ' search__pagination-link--active' 
                          : ''"
                    class="search__pagination-link"
                  >
                    <span th:text="${num}">1</span>
                  </button>
                </li>

                <!-- 다음 페이지 그룹으로 -->
                <li th:if="${hasNext}">
                  <button type="submit" name="page" th:value="${currentPage + 1}" class="search__pagination-link">&gt;</button>
                </li>

                <!-- 마지막 페이지로 -->
                <li>
                  <button type="submit" name="page" th:value="${totalPages}" class="search__pagination-link">&gt;&gt;</button>
                </li>
              </ul>
            </nav>
          </form>
        </section>
      </main>

      <!-- 푸터 -->
      <!-- <footer th:replace="fragments/footer :: footer"></footer> -->
    </div>

    <!-- JS -->
    <script type="module" th:src="@{/features/search/js/search_page.js}"></script>
  </body>
</html>
