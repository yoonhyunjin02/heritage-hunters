<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <th:block th:insert="~{fragments/head :: common-head('Map')}"></th:block>
  <link rel="stylesheet" th:href="@{/features/map/css/map.css}">
</head>
<body>
<!-- 사이트 공통 헤더 -->
<div th:replace="~{fragments/header :: common-header}"></div>

<!-- 지도 페이지 배너 -->
<section class="map-banner" aria-label="지도 안내 배너">
  <div class="map-banner__inner">
    <!-- 왼쪽 이미지 -->
    <div class="map-banner__visual" aria-hidden="true">
      <img
          class="map-banner__img"
          th:src="@{/images/banner/map-banner.png}"
          src="/images/banner/map-banner.png"
          alt="대한민국 지도 일러스트"
          loading="eager"
      />
    </div>

    <!-- 오른쪽 문구 -->
    <div class="map-banner__copy">
      <h2 class="map-banner__title">
        방문하고 싶은 박물관 · 미술관 또는 문화재 위치를 찾아보세요!
      </h2>
      <p>해당 문화재가 궁금하다면 정보 페이지로 바로 이동할 수 있어요</p>
    </div>
  </div>
</section>

<!-- 지도 전용 헤더(툴바) -->
<div class="map-toolbar">
  <div class="toolbar-left">
    <!-- 햄버거 버튼 -->
    <button id="navToggle" class="hamburger-btn" aria-label="메뉴 열기" aria-expanded="false">
      <img src="/images/icons/hamburger.svg" alt="메뉴"/>
    </button>

    <!-- 세그먼트 토글 -->
    <div class="segmented" id="typeSegment">
      <button class="seg-btn" data-type="all" aria-pressed="true">전체</button>
      <button class="seg-btn" data-type="heritage" aria-pressed="false">문화재</button>
      <button class="seg-btn" data-type="museum" aria-pressed="false">박물관·미술관</button>
    </div>
  </div>

  <div class="toolbar-right">
    <div class="toolbar-search">
      <input id="search" type="text" placeholder="장소 또는 지역을 검색하세요." autocomplete="off" />
      <span class="search-icon" aria-hidden="true">
          <img src="/images/icons/search.svg" alt="검색" width="20" height="20" />
      </span>
    </div>
  </div>
</div>

<!-- main -->
<main class="map-root"
      th:attr="data-endpoint=@{/map},data-maps-key=${mapsApiKey},data-map-id='109936b5c5c9266ad969d919'">

  <!-- 왼쪽 사이드 네비게이션 -->
  <nav id="sideNav" class="side-nav" role="navigation" aria-label="지도 범례와 필터">
    <!-- 범례 -->
    <section class="legend">
      <h3 class="legend-title-unique" id="legendHeading" tabindex="-1">범례</h3>
      <ul class="legend-list">
        <li class="legend-item">
          <img src="/images/icons/location.svg" alt="문화재 위치 아이콘" class="legend-icon legend-heritage" />
          <span>문화재</span>
        </li>
        <li class="legend-item">
          <img src="/images/icons/location.svg" alt="박물관·미술관 위치 아이콘" class="legend-icon legend-museum" />
          <span>박물관·미술관</span>
        </li>
        <li class="legend-item">
          <img src="/images/icons/location.svg" alt="내 위치 아이콘" class="legend-icon legend-my" />
          <span>내 위치</span>
        </li>
        <li class="legend-footnote">숫자 = 근접 지점 수</li>
        <li class="legend-note">
          <span class="cluster-swatch cluster-swatch-blue" aria-hidden="true">10</span>
          근접 지점 수 10개 이하
        </li>
        <li class="legend-note">
          <span class="cluster-swatch cluster-swatch-red" aria-hidden="true">15</span>
          근접 지점 수 15개 초과
        </li>
      </ul>
    </section>

    <!-- 필터 -->
    <section class="filters" aria-labelledby="filterHeading" style="margin-top:14px">
      <h3 id="filterHeading" class="legend-title">필터</h3>

      <!-- 박물관·미술관 카테고리 -->
      <details id="museumFilter" open>
        <summary>박물관·미술관 카테고리</summary>
        <div class="filter-group" id="museumCatList" aria-label="박물관·미술관 카테고리"></div>
      </details>

      <!-- 문화재 종목 -->
      <details id="heritageFilter" open>
        <summary>문화재 종목</summary>
        <div class="filter-group" id="heritageDesignationList" aria-label="문화재 종목"></div>
      </details>
    </section>

    <!-- 검색 상태 배지 -->
    <section id="searchBadge" class="legend-note" style="display:none; margin-top:10px">
      <span>검색: <strong id="searchQueryText"></strong></span>
      <button id="clearSearchBtn" class="locate-btn" style="margin-left:6px">검색 해제</button>
    </section>

    <div class="controls-row">
      <button id="locateBtn" class="locate-btn" aria-label="내 위치로 이동">
        <img src="/images/icons/target.svg" alt="" class="icon" width="16" height="16">
        <span>내 위치</span>
      </button>

      <button id="sortByDistance" class="locate-btn" disabled>가까운 순</button>
    </div>

    <!-- 목록 헤더 -->
    <h3 class="legend-title" style="margin-top:14px">
      현재 화면 지점 <span id="listCount" style="color:#FFFFFF;font-weight:600"></span>
    </h3>

    <!-- 목록 컨테이너 (renderList가 씀) -->
    <div id="list" class="list" style="max-height: 40vh;"></div>

    <button id="resetAllBtn" class="side-reset-btn" type="button" style="margin-top:12px">
      초기화
    </button>
  </nav>

  <section class="map-area">
    <div id="map"></div>
  </section>
</main>

<!-- 공통 푸터 -->
<div th:replace="~{fragments/footer :: common-footer}"></div>

<!-- JS -->
<script defer th:src="@{/features/map/js/map.js}"></script>
<script defer th:src="@{/features/map/js/my_location.js}"></script>
<script defer src="https://unpkg.com/@googlemaps/markerclusterer@2.5.3/dist/index.min.js"></script>
<script defer th:src="@{/features/map/js/designation_map.js}"></script>
<script defer th:src="@{/features/map/js/nav_toggle.js}"></script>
<script defer th:src="@{/features/map/js/segment_toggle.js}"></script>
<script defer th:src="@{/features/map/js/side_nav.js}"></script>
</body>
</html>